<!doctype html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="xdocs-url-prefix" content="./">

  

  <meta name="description" content="Не пройшло і... Ех, час летить. Але й Мавка не стоїть на місці.">

  <title>Цикл подій, tcp, планувальник - Мавка 0.121.0 | Часопис Мавки</title>

  <link rel="icon" type="image/png" href="./ресурси/тема/часопис.лого.png" />
  <link rel="icon" sizes="any" type="image/svg+xml" href="./ресурси/тема/часопис.лого.svg">

  <link rel="stylesheet" href="./ресурси/ядро/highlight-atom-one-dark.css">
<link rel="stylesheet" href="./ресурси/тема/тема.css">
</head>
<body>

<div class="XDocsPage">
  <div class="XDocsPageNavigation" data-is-navigation="true" data-hidden-on-mobile="true"><div class="XDocsPageNavigationHead">
  <a href="./index.html" class="XDocsPageNavigationHeadLogo">
    <img src="./ресурси/тема/часопис.лого.svg" alt="">
  </a>
</div>
<div class="XDocsPageNavigationSearch">
  <button>Пошук... (Alt + /)</button>
  <iframe src="./ресурси/search.html"></iframe>
</div>
<a
  href="./index.html"
  class="XDocsPageNavigationItem "
  data-navigation-item="Вступ"
>
  Вступ
</a>
<button
  class="XDocsPageNavigationItem"
  data-navigation-item="Травень 2025"
  data-navigation-item-expanded="true">
  Травень 2025
  <span class="XDocsPageNavigationItemArrow">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
      <path d="M480-357.85 253.85-584 296-626.15l184 184 184-184L706.15-584 480-357.85Z"></path>
    </svg>
  </span>
</button>
<div
  class="XDocsPageNavigationSubmenu"
  data-navigation-submenu="Травень 2025"
  data-navigation-submenu-shown="true"
>
  <a
  href="./2025-05-26-мавка-0-121-0.html"
  class="XDocsPageNavigationSubmenuItem active"
  data-navigation-item="Цикл подій, tcp, планувальник - Мавка 0.121.0"
>
  Цикл подій, tcp, планувальник - Мавка 0.121.0
</a>
</div>
<button
  class="XDocsPageNavigationItem"
  data-navigation-item="Лютий 2025"
  data-navigation-item-expanded="false">
  Лютий 2025
  <span class="XDocsPageNavigationItemArrow">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
      <path d="M480-357.85 253.85-584 296-626.15l184 184 184-184L706.15-584 480-357.85Z"></path>
    </svg>
  </span>
</button>
<div
  class="XDocsPageNavigationSubmenu"
  data-navigation-submenu="Лютий 2025"
  data-navigation-submenu-shown="false"
>
  <a
  href="./2025-02-28-будуємо-мавку-на-linux-швидкий-спосіб.html"
  class="XDocsPageNavigationSubmenuItem "
  data-navigation-item="Будуємо Мавку на GNU/Linux (швидкий спосіб)"
>
  Будуємо Мавку на GNU/Linux (швидкий спосіб)
</a>
<a
  href="./2025-02-28-будуємо-мавку-на-linux.html"
  class="XDocsPageNavigationSubmenuItem "
  data-navigation-item="Будуємо Мавку на GNU/Linux"
>
  Будуємо Мавку на GNU/Linux
</a>
<a
  href="./2025-02-27-новий-розбирач-мавки.html"
  class="XDocsPageNavigationSubmenuItem "
  data-navigation-item="Новий розбирач Мавки"
>
  Новий розбирач Мавки
</a>
<a
  href="./2025-02-14-оновлення-теорії-мавки.html"
  class="XDocsPageNavigationSubmenuItem "
  data-navigation-item="Оновлення Теорії Мавки"
>
  Оновлення Теорії Мавки
</a>
<a
  href="./2025-02-14-переїзд-вебсервісів-мавки.html"
  class="XDocsPageNavigationSubmenuItem "
  data-navigation-item="Переїзд вебсервісів Мавки"
>
  Переїзд вебсервісів Мавки
</a>
</div>
<button
  class="XDocsPageNavigationItem"
  data-navigation-item="Січень 2025"
  data-navigation-item-expanded="false">
  Січень 2025
  <span class="XDocsPageNavigationItemArrow">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
      <path d="M480-357.85 253.85-584 296-626.15l184 184 184-184L706.15-584 480-357.85Z"></path>
    </svg>
  </span>
</button>
<div
  class="XDocsPageNavigationSubmenu"
  data-navigation-submenu="Січень 2025"
  data-navigation-submenu-shown="false"
>
  <a
  href="./2025-01-03-дієкод.html"
  class="XDocsPageNavigationSubmenuItem "
  data-navigation-item="Дієкод"
>
  Дієкод
</a>
<a
  href="./2025-01-01-порядок-5.html"
  class="XDocsPageNavigationSubmenuItem "
  data-navigation-item="Порядок 5.0"
>
  Порядок 5.0
</a>
</div>
<button
  class="XDocsPageNavigationItem"
  data-navigation-item="Грудень 2024"
  data-navigation-item-expanded="false">
  Грудень 2024
  <span class="XDocsPageNavigationItemArrow">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
      <path d="M480-357.85 253.85-584 296-626.15l184 184 184-184L706.15-584 480-357.85Z"></path>
    </svg>
  </span>
</button>
<div
  class="XDocsPageNavigationSubmenu"
  data-navigation-submenu="Грудень 2024"
  data-navigation-submenu-shown="false"
>
  <a
  href="./2024-12-04-керування-памʼятю-і-теорія-мавки.html"
  class="XDocsPageNavigationSubmenuItem "
  data-navigation-item="Теорія Мавки і керування памʼятю"
>
  Теорія Мавки і керування памʼятю
</a>
<a
  href="./2024-12-01-створюємо-розширення-мавки.html"
  class="XDocsPageNavigationSubmenuItem "
  data-navigation-item="Створюємо розширення Мавки"
>
  Створюємо розширення Мавки
</a>
</div>
<button
  class="XDocsPageNavigationItem"
  data-navigation-item="Вересень 2024"
  data-navigation-item-expanded="false">
  Вересень 2024
  <span class="XDocsPageNavigationItemArrow">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
      <path d="M480-357.85 253.85-584 296-626.15l184 184 184-184L706.15-584 480-357.85Z"></path>
    </svg>
  </span>
</button>
<div
  class="XDocsPageNavigationSubmenu"
  data-navigation-submenu="Вересень 2024"
  data-navigation-submenu-shown="false"
>
  <a
  href="./2024-09-08-реформа.html"
  class="XDocsPageNavigationSubmenuItem "
  data-navigation-item="У Мавки реформа!"
>
  У Мавки реформа!
</a>
</div>
<div class="XDocsPageNavigationFooterWrapper">
  <div class="XDocsPageNavigationFooter">
    <a href="https://мавка.укр"><img src="./ресурси/тема/мавка.лого.svg" alt=""></a>
    Часопис<a href="https://мавка.укр" style="all: unset; cursor: pointer; margin-right: 0.4ch; margin-left: 0.4ch;">Мавки</a>
  </div>
</div>
</div>
  <button data-is-mobile-navigation-toggle="true" class="XDocsPageMobileNavigationToggle">
    <svg data-menu-icon="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
      <path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z" />
    </svg>
    <svg data-close-icon="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
         fill="currentColor">
      <path
        d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z" />
    </svg>
  </button>
  <div class="XDocsPageContent">
    
    <h1>Мавка 0.121.0</h1>
<p>Не пройшло і... Ех, час летить. Але й Мавка не стоїть на місці.</p>
<p>Основним нововведенням Мавки 0.121.0 є так званий &quot;цикл подій&quot;.
Якщо коротко, то це штука, яка дозволяє втілити так звану &quot;асинхронність&quot; використовуючи лише один &quot;потік&quot;.
Якщо простіше, то ця річ дозволяє відкладати виконання дій.</p>
<p>До прикладу, ви хочете відкласти виконання якоїсь дії на декілька секунд, але не хочете
блокувати виконання поточної дії. Хто знайомий з JavaScript, зробити це можна через setTimeout.
Тепер можна і в Мавці:</p>
<pre><div class="XDocsCodeWrapper"><code class="hljs"><span class="hljs-keyword">взяти</span> <span class="hljs-keyword">біб</span> планувальник [відкласти]

<span class="hljs-keyword">дія</span> <span class="hljs-title function_">п</span><span class="hljs-title function_">ривітатись</span>()
  <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;Привіт! :)&quot;</span>)
<span class="hljs-keyword">кінець</span>

<span class="hljs-title function_">в</span><span class="hljs-title function_">ідкласти</span>(привітатись, <span class="hljs-number">2000</span>) <span class="hljs-comment">;; 2 сек</span>

<span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;Я перший ;)&quot;</span>)
</code></div></pre>
<p>Як це працює:</p>
<ol>
<li>Виконавши <code>відкласти</code>, Мавка зберегла дію <code>привітатись</code> та попросила операційну систему повідомити, коли пройде 2000
мс.</li>
<li>Після виконання останньої інструкції (<code>друк(&quot;Я перший ;)&quot;)</code>) Мавка запускає так званий &quot;цикл подій&quot;,
який блокує поточний &quot;потік&quot; допоки операційна система не скаже, що пройшло 2000 мс.</li>
<li>Як тільки операційна система сповістила, Мавка передає в Машину дію <code>привітатись</code>, яка її й виконує.</li>
<li>Після виконання <code>привітатись</code> Мавка знову запускає цей цикл, але, так як більше немає запланованих завдань,
то цикл зупиняться і відбувається вихід з програми.</li>
</ol>
<p>Завдяки &quot;циклу подій&quot; в Мавці тепер також можна запускати &quot;асинхронні&quot; &quot;tcp-сервер&quot; та &quot;tcp-клієнт&quot;. А також повторювати
виконання певної дії з певним інтервалом.</p>
<details>
<summary>tcp-сервер</summary>
<pre><div class="XDocsCodeWrapper"><code class="hljs"><span class="hljs-keyword">взяти</span> <span class="hljs-keyword">біб</span> інтернет

<span class="hljs-keyword">дія</span> <span class="hljs-title function_">о</span><span class="hljs-title function_">бробити_зупинку_обслуговувача</span>(обслуговувач, помилка)
  <span class="hljs-keyword">якщо</span> помилка
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;зупинено з помилкою&quot;</span>, помилка)
  <span class="hljs-keyword">інакше</span>
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;зупинено&quot;</span>)
  <span class="hljs-keyword">кінець</span>
<span class="hljs-keyword">кінець</span>

<span class="hljs-keyword">дія</span> <span class="hljs-title function_">о</span><span class="hljs-title function_">бробити_дані_звʼязку</span>(звʼязок, дані)
  <span class="hljs-title function_">в</span><span class="hljs-title function_">ивести</span>(<span class="hljs-string">&quot;отримано&quot;</span>, <span class="hljs-title function_">ю</span><span class="hljs-title function_">нікод</span>(дані))
  інтернет.<span class="hljs-title function_">н</span><span class="hljs-title function_">адіслати</span>(дані, звʼязок)

  <span class="hljs-title function_">в</span><span class="hljs-title function_">ивести</span>(<span class="hljs-string">&quot;надіслано&quot;</span>, <span class="hljs-title function_">ю</span><span class="hljs-title function_">нікод</span>(дані))
<span class="hljs-keyword">кінець</span>

<span class="hljs-keyword">дія</span> <span class="hljs-title function_">о</span><span class="hljs-title function_">бробити_закінчення_звʼязку</span>(звʼязок, помилка)
  <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;клієнт закінчив повідомлення&quot;</span>)
<span class="hljs-keyword">кінець</span>

<span class="hljs-keyword">дія</span> <span class="hljs-title function_">о</span><span class="hljs-title function_">бробити_відключення_звʼязку</span>(звʼязок, помилка)
  <span class="hljs-keyword">якщо</span> помилка
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;відключено з помилкою&quot;</span>, помилка)
  <span class="hljs-keyword">інакше</span>
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;відключено&quot;</span>)
  <span class="hljs-keyword">кінець</span>
<span class="hljs-keyword">кінець</span>

<span class="hljs-keyword">дія</span> <span class="hljs-title function_">о</span><span class="hljs-title function_">бробити_підключення_звʼязку_обслуговувача</span>(обслуговувач, звʼязок, помилка)
  <span class="hljs-keyword">якщо</span> помилка
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;помилка підключення&quot;</span>, помилка)
  <span class="hljs-keyword">інакше</span>
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;підключено&quot;</span>, звʼязок)

    звʼязок.обробник_даних = обробити_дані_звʼязку
    звʼязок.обробник_закінчення = обробити_закінчення_звʼязку
    звʼязок.обробник_відключення = обробити_відключення_звʼязку
  <span class="hljs-keyword">кінець</span>
<span class="hljs-keyword">кінець</span>

<span class="hljs-keyword">дія</span> <span class="hljs-title function_">о</span><span class="hljs-title function_">бробити_запуск_обслуговувача</span>(обслуговувач, помилка)
  <span class="hljs-keyword">якщо</span> помилка
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;помилка запуску&quot;</span>, помилка)
  <span class="hljs-keyword">інакше</span>
    обслуговувач.обробник_зупинки = обробити_зупинку_обслуговувача
    обслуговувач.обробник_підключення_звʼязку = обробити_підключення_звʼязку_обслуговувача
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;запущено&quot;</span>)
  <span class="hljs-keyword">кінець</span>
<span class="hljs-keyword">кінець</span>

інтернет.<span class="hljs-title function_">о</span><span class="hljs-title function_">бслуговувати</span>(
  <span class="hljs-string">&quot;0.0.0.0&quot;</span>,
  <span class="hljs-number">8080</span>,
  обробити_запуск_обслуговувача
)
</code></div></pre>
</details>
<details>
<summary>tcp-клієнт</summary>
<pre><div class="XDocsCodeWrapper"><code class="hljs"><span class="hljs-keyword">взяти</span> <span class="hljs-keyword">біб</span> інтернет

<span class="hljs-keyword">дія</span> <span class="hljs-title function_">о</span><span class="hljs-title function_">бробити_дані_звʼязку</span>(звʼязок, дані)
  <span class="hljs-title function_">в</span><span class="hljs-title function_">ивести</span>(<span class="hljs-string">&quot;отримано&quot;</span>, <span class="hljs-title function_">ю</span><span class="hljs-title function_">нікод</span>(дані))
<span class="hljs-keyword">кінець</span>

<span class="hljs-keyword">дія</span> <span class="hljs-title function_">о</span><span class="hljs-title function_">бробити_закінчення_звʼязку</span>(звʼязок, помилка)
  <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;обслуговувач закінчив повідомлення&quot;</span>)
<span class="hljs-keyword">кінець</span>

<span class="hljs-keyword">дія</span> <span class="hljs-title function_">о</span><span class="hljs-title function_">бробити_відключення_звʼязку</span>(звʼязок, помилка)
  <span class="hljs-keyword">якщо</span> помилка
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;відключено з помилкою&quot;</span>, помилка)
  <span class="hljs-keyword">інакше</span>
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;відключено&quot;</span>)
  <span class="hljs-keyword">кінець</span>
<span class="hljs-keyword">кінець</span>

<span class="hljs-keyword">дія</span> <span class="hljs-title function_">о</span><span class="hljs-title function_">бробити_підключення_звʼязку</span>(звʼязок, помилка)
  <span class="hljs-keyword">якщо</span> помилка
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;помилка підключення&quot;</span>, помилка)
  <span class="hljs-keyword">інакше</span>
    <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;підключено&quot;</span>, звʼязок)

    звʼязок.обробник_даних = обробити_дані_звʼязку
    звʼязок.обробник_закінчення = обробити_закінчення_звʼязку
    звʼязок.обробник_відключення = обробити_відключення_звʼязку

    інтернет.<span class="hljs-title function_">н</span><span class="hljs-title function_">адіслати</span>(ю<span class="hljs-string">&quot;привіт\n&quot;</span>, звʼязок)
    <span class="hljs-title function_">в</span><span class="hljs-title function_">ивести</span>(<span class="hljs-string">&quot;надіслано&quot;</span>, ю<span class="hljs-string">&quot;привіт\n&quot;</span>)
  <span class="hljs-keyword">кінець</span>
<span class="hljs-keyword">кінець</span>

інтернет.<span class="hljs-title function_">з</span><span class="hljs-title function_">вʼязатись</span>(
  <span class="hljs-string">&quot;127.0.0.1&quot;</span>,
  <span class="hljs-number">8080</span>,
  обробити_підключення_звʼязку
)
</code></div></pre>
</details>
<details>
<summary>періодичне виконання</summary>
<pre><div class="XDocsCodeWrapper"><code class="hljs"><span class="hljs-keyword">взяти</span> <span class="hljs-keyword">біб</span> планувальник

к = <span class="hljs-number">0</span>

п = планувальник.<span class="hljs-title function_">п</span><span class="hljs-title function_">еріодично</span>(<span class="hljs-keyword">дія</span>()
  к := к + <span class="hljs-number">1</span>
  
  <span class="hljs-title function_">д</span><span class="hljs-title function_">рук</span>(<span class="hljs-string">&quot;кількість&quot;</span>, к)

  <span class="hljs-keyword">якщо</span> к == <span class="hljs-number">10</span>
    планувальник.<span class="hljs-title function_">с</span><span class="hljs-title function_">касувати_періодичне</span>(п)
  <span class="hljs-keyword">кінець</span>
<span class="hljs-keyword">кінець</span>, <span class="hljs-number">1000</span>)
</code></div></pre>
</details>
<blockquote>
<p>&quot;цикл подій&quot; в Мавці використовує io_uring, який не підтримується на Linux нижче 5.1 версії</p>
</blockquote>
<p>Також інші зміни:</p>
<ul>
<li>додано структуру <code>Буфер</code> (аналог структури <code>байти</code>, тільки дані всередині можна змінювати)</li>
<li>різні загальні покращення та виправлення</li>
</ul>
<p>ЧаПи:</p>
<details>
<summary>Коли буде бета Мавки?</summary>
<p>Синтаксично мова дозріла. З того, що я зараз бачу, то є ще різні речі в Машині, над якими необхідно попрацювати.
Також в бета Мавці має бути стабільний РМв1.
Після цього ще провести загальний аналіз, &quot;рефакторинг&quot; тощо.</p>
<p>Але не обовʼязково чекати бету чи випуск, щоб пробувати щось втілювати Мавкою.
Якщо вам чогось не вистачає, завжди можна додати це власноруч ;)</p>
</details> 
<details>
<summary>Коли буде випуск Мавки 1.0.0?</summary>
<p>Не раніше бета Цілі.</p>
</details> 
<hr>
<p>Спробувати Мавку 0.121.0:</p>
<ul>
<li><a href="https://xn--80ae5bu9f.xn--80aaf6ah.xn--j1amh/%D0%B2%D0%B8%D0%BF%D1%83%D1%81%D0%BA-%D0%BC%D0%B0%D0%B2%D0%BA%D0%B8-0.121.0.html">Завантажити Мавку 0.121.0 з Архіву</a></li>
<li><a href="./2025-02-28-%D0%B1%D1%83%D0%B4%D1%83%D1%94%D0%BC%D0%BE-%D0%BC%D0%B0%D0%B2%D0%BA%D1%83-%D0%BD%D0%B0-linux-%D1%88%D0%B2%D0%B8%D0%B4%D0%BA%D0%B8%D0%B9-%D1%81%D0%BF%D0%BE%D1%81%D1%96%D0%B1.html">Як просто і швидко збудувати Мавку на Linux?</a></li>
<li><a href="./2025-02-28-%D0%B1%D1%83%D0%B4%D1%83%D1%94%D0%BC%D0%BE-%D0%BC%D0%B0%D0%B2%D0%BA%D1%83-%D0%BD%D0%B0-linux.html">Як збудувати Мавку на Linux з джерельних файлів?</a></li>
</ul>
<hr>
<p><em>Написав <a href="https://xn--90afr.xn--j1amh">Давид</a>. Опубліковано 27.05.2025.</em></p>

    
    <div class="XDocsPageContentBcFw">
      <a data-is-prev="true" href="./index.html">Відступ</a>
      <a data-is-next="true" href="./2025-02-28-будуємо-мавку-на-linux-швидкий-спосіб.html">Наступ</a >
    </div>
  </div>
</div>

<script src="./ресурси/ядро/ядро.js"></script>
<script src="./ресурси/тема/тема.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DCB6ENR1SK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DCB6ENR1SK');
</script>
</body>
</html>